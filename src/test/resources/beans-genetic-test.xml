<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright 2012 George Belden This file is part of ZodiacEngine. ZodiacEngine 
	is free software: you can redistribute it and/or modify it under the terms 
	of the GNU General Public License as published by the Free Software Foundation, 
	either version 3 of the License, or (at your option) any later version. ZodiacEngine 
	is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
	without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
	PURPOSE. See the GNU General Public License for more details. You should 
	have received a copy of the GNU General Public License along with ZodiacEngine. 
	If not, see <http://www.gnu.org/licenses/>. -->
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
       		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       		http://www.springframework.org/schema/context
       		http://www.springframework.org/schema/context/spring-context-3.0.xsd
       		http://www.springframework.org/schema/tx 
     		http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">

	<context:annotation-config />
	<tx:annotation-driven />

	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location">
			<value>classpath:zodiacengine.properties</value>
		</property>
	</bean>

	<bean
		class="com.ciphertool.zodiacengine.gui.service.GeneticCipherSolutionService"
		id="cipherSolutionService">
		<property name="geneticAlgorithm" ref="geneticAlgorithm" />
		<property name="solutionSetDao" ref="solutionSetDao" />
		<property name="commandsBefore" value="${app.commands.before}" />
		<property name="commandsAfter" value="${app.commands.after}" />
	</bean>

	<bean
		class="com.ciphertool.zodiacengine.gui.controller.ZodiacCipherSolutionController"
		id="cipherSolutionController">
		<property name="cipherSolutionService" ref="cipherSolutionService" />
		<property name="cipherDao" ref="cipherDao" />
		<property name="fitnessEvaluatorDefault" ref="defaultFitnessEvaluator" />
		<property name="crossoverAlgorithmDefault" ref="defaultCrossoverAlgorithm" />
	</bean>

	<bean class="com.ciphertool.sentencebuilder.dao.FrequencyWordListDao"
		id="wordListDao">
		<constructor-arg index="0"
			type="com.ciphertool.sentencebuilder.dao.WordDao">
			<ref bean="wordDao" />
		</constructor-arg>
	</bean>

	<bean
		class="com.ciphertool.zodiacengine.genetic.util.SolutionChromosomeGenerator"
		id="chromosomeGenerator">
		<property name="wordListDao" ref="wordListDao" />
	</bean>

	<!-- Old fitnessEvaluator bean definition is currently unused but the definition 
		is here for backward compatibility -->
	<bean
		class="com.ciphertool.zodiacengine.genetic.util.CipherSolutionFitnessEvaluator"
		id="cipherSolutionFitnessEvaluator" />

	<bean
		class="com.ciphertool.zodiacengine.genetic.util.CipherSolutionFrequencyFitnessEvaluator"
		id="defaultFitnessEvaluator">
		<property name="expectedLetterFrequencies">
			<map>
				<entry key="a" value="${language.english.frequency.a}" />
				<entry key="b" value="${language.english.frequency.b}" />
				<entry key="c" value="${language.english.frequency.c}" />
				<entry key="d" value="${language.english.frequency.d}" />
				<entry key="e" value="${language.english.frequency.e}" />
				<entry key="f" value="${language.english.frequency.f}" />
				<entry key="g" value="${language.english.frequency.g}" />
				<entry key="h" value="${language.english.frequency.h}" />
				<entry key="i" value="${language.english.frequency.i}" />
				<entry key="j" value="${language.english.frequency.j}" />
				<entry key="k" value="${language.english.frequency.k}" />
				<entry key="l" value="${language.english.frequency.l}" />
				<entry key="m" value="${language.english.frequency.m}" />
				<entry key="n" value="${language.english.frequency.n}" />
				<entry key="o" value="${language.english.frequency.o}" />
				<entry key="p" value="${language.english.frequency.p}" />
				<entry key="q" value="${language.english.frequency.q}" />
				<entry key="r" value="${language.english.frequency.r}" />
				<entry key="s" value="${language.english.frequency.s}" />
				<entry key="t" value="${language.english.frequency.t}" />
				<entry key="u" value="${language.english.frequency.u}" />
				<entry key="v" value="${language.english.frequency.v}" />
				<entry key="w" value="${language.english.frequency.w}" />
				<entry key="x" value="${language.english.frequency.x}" />
				<entry key="y" value="${language.english.frequency.y}" />
				<entry key="z" value="${language.english.frequency.z}" />
			</map>
		</property>
	</bean>

	<bean class="com.ciphertool.genetics.util.MaximizationFitnessComparator"
		id="fitnessComparator" />

	<bean class="com.ciphertool.genetics.Population" id="population">
		<property name="chromosomeGenerator" ref="chromosomeGenerator" />
		<property name="fitnessEvaluator" ref="defaultFitnessEvaluator" />
		<property name="taskExecutor" ref="taskExecutor" />
	</bean>

	<bean class="com.ciphertool.zodiacengine.genetic.dao.WordGeneListDao"
		id="geneListDao">
		<property name="wordListDao" ref="wordListDao" />
	</bean>

	<bean
		class="com.ciphertool.genetics.algorithms.LiberalCrossoverAlgorithm"
		id="liberalCrossoverAlgorithm">
		<property name="fitnessEvaluator" ref="defaultFitnessEvaluator" />
		<property name="geneListDao" ref="geneListDao" />
	</bean>
	
	<bean
		class="com.ciphertool.genetics.algorithms.ConservativeCrossoverAlgorithm"
		id="conservativeCrossoverAlgorithm">
		<property name="fitnessEvaluator" ref="defaultFitnessEvaluator" />
		<property name="geneListDao" ref="geneListDao" />
	</bean>

	<bean
		class="com.ciphertool.genetics.algorithms.LowestCommonGroupCrossoverAlgorithm"
		id="defaultCrossoverAlgorithm">
		<property name="fitnessEvaluator" ref="defaultFitnessEvaluator" />
		<property name="geneListDao" ref="geneListDao" />
	</bean>

	<bean class="com.ciphertool.zodiacengine.genetic.dao.PlaintextSequenceDao" id="sequenceDao" />
	
	<bean class="com.ciphertool.genetics.algorithms.SingleSequenceMutationAlgorithm" id="defaultMutationAlgorithm">
		<property name="sequenceDao" ref="sequenceDao"/>
	</bean>
	
	<bean class="com.ciphertool.genetics.algorithms.LiberalMutationAlgorithm" id="liberalMutationAlgorithm" />
	
	<bean class="com.ciphertool.genetics.algorithms.ConservativeMutationAlgorithm" id="conservativeMutationAlgorithm" />
	
	<bean class="com.ciphertool.genetics.algorithms.LowestCommonGroupMutationAlgorithm" id="lowestCommonGroupMutationAlgorithm" />
	
	<bean
		class="com.ciphertool.genetics.algorithms.ConcurrentBasicGeneticAlgorithm"
		id="geneticAlgorithm">
		<property name="finalSurvivorCount" value="${genetic.algorithm.finalSurvivorCount}" />
		<property name="crossoverAlgorithm" ref="defaultCrossoverAlgorithm" />
		<property name="mutationAlgorithm" ref="defaultMutationAlgorithm" />
		<property name="fitnessEvaluator" ref="defaultFitnessEvaluator" />
		<property name="population" ref="population" />
		<property name="fitnessComparator" ref="fitnessComparator" />
		<property name="taskExecutor" ref="taskExecutor" />
	</bean>

	<bean class="com.ciphertool.sentencebuilder.dao.WordDao" id="wordDao">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean class="com.ciphertool.zodiacengine.dao.CiphertextDao" id="ciphertextDao">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean class="com.ciphertool.zodiacengine.dao.PlaintextDao" id="plaintextDao">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean class="com.ciphertool.zodiacengine.dao.CipherDao" id="cipherDao">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean class="com.ciphertool.zodiacengine.dao.SolutionDao" id="solutionDao">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean class="com.ciphertool.zodiacengine.dao.SolutionSetDao" id="solutionSetDao">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>

	<bean id="taskExecutor"
		class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">
		<property name="corePoolSize" value="${taskExecutor.corePoolSize}" />
		<property name="maxPoolSize" value="${taskExecutor.maxPoolSize}" />
		<!-- queueCapacity should be the same as populationSize, or we will get 
			rejected execution exceptions -->
		<property name="queueCapacity" value="${taskExecutor.queueCapacity}" />
		<property name="keepAliveSeconds" value="5" />
		<property name="allowCoreThreadTimeOut" value="true" />
	</bean>

	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="${jdbc.driver}" />
		<property name="url" value="${jdbc.url}" />
		<property name="username" value="${jdbc.user}" />
		<property name="password" value="${jdbc.password}" />
		<property name="initialSize" value="${jdbc.connections.initialsize}" />
		<property name="maxActive" value="${jdbc.connections.maxactive}" />
	</bean>

	<bean id="sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="annotatedClasses">
			<list>
				<value>com.ciphertool.zodiacengine.entities.Cipher</value>
				<value>com.ciphertool.zodiacengine.entities.Ciphertext</value>
				<value>com.ciphertool.zodiacengine.entities.SolutionSet</value>
				<value>com.ciphertool.zodiacengine.entities.Solution</value>
				<value>com.ciphertool.zodiacengine.entities.Plaintext</value>
				<value>com.ciphertool.sentencebuilder.entities.Word</value>
			</list>
		</property>
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
				<prop key="hibernate.show_sql">false</prop>
			</props>
		</property>
	</bean>

	<bean id="transactionManager"
		class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>
</beans>